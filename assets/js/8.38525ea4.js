(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{265:function(s,n,e){s.exports=e.p+"assets/img/image.8403c3b2.png"},310:function(s,n,e){"use strict";e.r(n);var a=e(13),t=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"自定义指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义指令"}},[s._v("#")]),s._v(" 自定义指令")]),s._v(" "),n("hr"),s._v(" "),n("h5",{attrs:{id:"一、需求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、需求"}},[s._v("#")]),s._v(" 一、需求")]),s._v(" "),n("p",[s._v("公司内部系统需要对复杂表单进行AI抓取信息在填写字段时进行信息展示，并且可供表单直接填入。还需要对AI抓取信息曝光和使用频率进行统计，以便运行进行采用率的统计。用于后期视频的运营策略。")]),s._v(" "),n("h4",{attrs:{id:"二、方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、方案"}},[s._v("#")]),s._v(" 二、方案")]),s._v(" "),n("p",[s._v("考虑到曝光是精确到每个表单字段的，是否可以开发一个自定义指令放在需要曝光的DOM上，这边也可以供其他操作复用。\n考虑要做一个自定义指令，而且触发的操作可能有很多种，于是先设置两种触发方式：")]),s._v(" "),n("blockquote",[n("p",[s._v("v-track:exposure|click={data, callback}曝光和统计\n绑定数据和操作约定了data和callback这样可以定义操作方式\n首先：曝光借助了JavaScript的API IntersectionObserver\n封装了一个类：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("class Exposure {\n    constructor(callback) {\n        if (!callback || typeof callback !== function) {\n            throw new Error('need callback or selector param');    \n        }\n        this.intersectionObserver = new IntersectionObserver((entries) => {\n          entries.forEach((item) => {\n              if (item.intersection > 0) {\n                  if (item.target) {\n                      callback();\n                      // 还可以曝光一次后停止监听\n                      // this.unobserve(item.target);               \n                  }           \n              }       \n          });     \n        });  \n    }\n\n    // 停止观察\n    unobserve(exposureHTMLElement) {\n        this.intersectionObserver.unobserve(exposureHTMLElement);\n    }\n    // 开始观察\n    observe(exposureHTMLElement) {\n        this.intersectionObserver.observe(exposureHTMLElement);\n    }\n    // 关闭观察器\n    disconnect() {\n        if (!this.intersectionObserver) {\n            return;        \n        }\n        this.intersectionObserver.disconnect();        \n    }\n}\n\nexport default Exposure;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[s._v("然后对操作进行分类：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import Exposure from './exposure';\n\nfunction bindExposureObserver(el, callback, data) {\n    const exposure = new Exposure(() => {\n      // 曝光\n      callback(data);  \n    });\n    exposure.observe(el);\n}\n\nfunction bindClick(el, callback, data) {\n    // 点击\n    el.addEventListener(\n        'click',\n        () => {\n            callback(data);    \n        },\n        'false'\n    );\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("p",[s._v("进行组件注册：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const trackCycle = {\n    inserted(el, binding) {\n        const { data, callback } = binding.value;\n        const { arg } = binding;\n\n        arg.split('|').forEach((item) => {\n            if (item === 'click') {\n                bindClick(el, callback, data);            \n            } else if (item === 'exposure') {\n                bindExposureObserver(el, callback, data);            \n            }\n        });                                                                                                                                                                                                                                                                                        \n    }\n};\n\nexport dafault trackCycle;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Vue.directive('track', exposureCycle)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("补充：我这里只需要第一个bind就行\n一个指令定义对象可以提供如下几个钩子函数 (均为可选)：")]),s._v(" "),n("blockquote",[n("p",[s._v("bind： 只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。"),n("br"),s._v("\ninserted：被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。"),n("br"),s._v("\nupdate：所在组件的 VNode 更新时调用，但是可能发生在其子 VNode 更新之前。"),n("br"),s._v("\ncomponentUpdated：指令所在组件的 VNode 及其子 VNode 全部更新后调用。"),n("br"),s._v("\nunbind：只调用一次，指令与元素解绑时调用。")])]),s._v(" "),n("p",[s._v("钩子函数参数：")]),s._v(" "),n("blockquote",[n("p",[s._v("el：指令所绑定的元素，可以用来直接操作 DOM。"),n("br"),s._v("\nbinding：一个对象，包含以下 property：arg、value、name、rawName、def modifiers等"),n("img",{attrs:{src:e(265),alt:"image",title:"yy"}}),s._v("\nvnode：Vue 编译生成的虚拟节点"),n("br"),s._v("\noldVnode：上一个虚拟节点，仅在 update 和 componentUpdated 钩子中可用。")])])])}),[],!1,null,null,null);n.default=t.exports}}]);